<!DOCTYPE html>
<html>
  <head>
    <title>Color triplets</title>  <!-- CHANGE THIS (title) -->
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugin-image-button-response.js"></script>
    <script src="jspsych/plugin-html-keyboard-response.js"></script>
    <script src="jspsych/plugin-html-button-response.js"></script>
    <script src="jspsych/plugin-image-keyboard-response.js"></script>
    <script src="jspsych/plugin-image-text-responseMAS.js"></script>
    <script src="jspsych/plugin-fullscreen.js"></script>
    <script src="jspsych/plugin-audio-button-response.js"></script>
    <script src="jspsych/plugin-image-keyboard-response.js"></script>
    <script src="jspsych/plugin-survey-multi-select.js"></script>
    <script src="jspsych/plugin-survey-html-form.js"></script>
    <script src="jspsych/plugin-survey-text.js"></script>
    <script src="jspsych/plugin-survey-likert.js"></script>
    <script src="jspsych/plugin-call-function.js"></script>
    <script src="jspsych/plugin-preload.js"></script>
    <script src="jspsych/plugin-image-button-response.js"></script>
    <script src ="colorNames.json"></script>
    <script src ="validationRandom.json"></script>
    <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
    <link href="jspsych/jspsych.css" rel="stylesheet" type="text/css" />
    
    <style>
        #wrapper {
            position: absolute;
            top: 50%;
            left: 50%;
            box-sizing: content-box;  
            width: 500px;
            height: 100px;
            padding: 5px;  
            border: 2px solid black;
        }

    </style>
  </head>
  <body></body>
  <script>
    //<script src="https://unpkg.com/jspsych@8.0.2"><script>
   // <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"><script>
    //<script src="https://unpkg.com/jspsych@7.3.4">

    var jsPsych = initJsPsych({
        show_progress_bar:false,
        on_data_update: function(){
            jsPsych.data.addProperties({worker_id: urlvar.workerId});
        },
        on_finish: function(){
            jsPsych.data.addProperties({worker_id: urlvar.workerId});
        },
        max_load_time: 120000
    });

    //set bg color to medium gray
    document.body.style.backgroundColor = "rgb(89,89,89)" //(D65 illuminant gray)
    
    // generating a user id and file name  
    var secret_code  = jsPsych.randomization.randomID(8);
    var filename = "triplets_colors_" + secret_code + ".csv"; // CHANGE THIS (file name)

    // this is to save to OSF using DataPipe
    //if want to save data more often, copy this and change the name, and save halfway through
      const save_data = { 
        type: jsPsychPipe,
        action: "save",
        experiment_id: "W31dcwJTrTgj", //change this for different experiments in datapipe
        filename: filename,
        data_string: ()=>jsPsych.data.get().csv()
      };

          /* create timeline */
    var timeline = [];
      
    // pulling info re: mechanical turk hit
    var urlvar = jsPsych.data.urlVariables();  
      
    //console.log(colorNames)
    //console.log(colorHex)

    // preload stimuli
    var preload = {
        type: jsPsychPreload,
        auto_preload: true,
        images: colorHex,
        show_progress_bar: true,
        message: "Loading experiment files...",
        error_message: "Oops! There's a problem loading files. Please refresh the page to try again."
    }  
    timeline.push(preload);


    var stimuli = [];

    //the hex codes of all colors we are using
    for (i = 0; i < colorHex.length; i++){
        stimuli.push(
            {item: colorHex[i]},
        )
    }

    var stimuli_arr = colorHex
      //plan: 
      //1) make a pool of random triplets
      //2) sample
    var validation = [
      //this is a list of ones you want to keep in
      // head is the one on top; choice 1 on Left choice 2 on Right
                    {head: 'img/55824D.png',	choice_1: 'img/96C58C.png',	choice_2: 'img/3B8378.png'},
                    {head: 'img/55824D.png',	choice_1: 'img/5E78A1.png',	choice_2: 'img/7EC6BA.png'},
                    {head: 'img/55824D.png',	choice_1: 'img/96C58C.png',	choice_2: 'img/5E78A1.png'},
                    {head: 'img/96C58C.png',	choice_1: 'img/7EC6BA.png',	choice_2: 'img/55824D.png'},
                    {head: 'img/96C58C.png',	choice_1: 'img/55824D.png',	choice_2: 'img/A0BAE6.png'},
                    {head: 'img/96C58C.png',	choice_1: 'img/A0BAE6.png',	choice_2: 'img/3B8378.png'},
                    {head: 'img/5E78A1.png',	choice_1: 'img/A0BAE6.png',	choice_2: 'img/3B8378.png'},
                    {head: 'img/5E78A1.png',	choice_1: 'img/55824D.png',	choice_2: 'img/7EC6BA.png'},
                    {head: 'img/5E78A1.png',	choice_1: 'img/55824D.png',	choice_2: 'img/A0BAE6.png'},
                    {head: 'img/A0BAE6.png',	choice_1: 'img/7EC6BA.png',	choice_2: 'img/5E78A1.png'},
                    {head: 'img/A0BAE6.png',	choice_1: 'img/96C58C.png',	choice_2: 'img/3B8378.png'},
                    {head: 'img/A0BAE6.png',	choice_1: 'img/5E78A1.png',	choice_2: 'img/96C58C.png'},
                    {head: 'img/3B8378.png',	choice_1: 'img/7EC6BA.png',	choice_2: 'img/5E78A1.png'},
                    {head: 'img/3B8378.png',	choice_1: 'img/55824D.png',	choice_2: 'img/7EC6BA.png'},
                    {head: 'img/7EC6BA.png',	choice_1: 'img/A0BAE6.png',	choice_2: 'img/3B8378.png'},
                    {head: 'img/7EC6BA.png',	choice_1: 'img/3B8378.png',	choice_2: 'img/96C58C.png'},
                    {head: 'img/A06776.png',	choice_1: 'img/E6A8B7.png',	choice_2: 'img/A8664B.png'},
                    {head: 'img/A06776.png',	choice_1: 'img/83764C.png',	choice_2: 'img/F1A78A.png'},
                    {head: 'img/A06776.png',	choice_1: 'img/83764C.png',	choice_2: 'img/E6A8B7.png'},
                    {head: 'img/E6A8B7.png',	choice_1: 'img/A06776.png',	choice_2: 'img/F1A78A.png'},
                    {head: 'img/E6A8B7.png',	choice_1: 'img/A06776.png',	choice_2: 'img/C7B88B.png'},
                    {head: 'img/E6A8B7.png',	choice_1: 'img/C7B88B.png',	choice_2: 'img/A8664B.png'},
                    {head: 'img/83764C.png',	choice_1: 'img/C7B88B.png',	choice_2: 'img/A8664B.png'},
                    {head: 'img/83764C.png',	choice_1: 'img/A06776.png',	choice_2: 'img/F1A78A.png'},
                    {head: 'img/83764C.png',	choice_1: 'img/A06776.png',	choice_2: 'img/C7B88B.png'},
                    {head: 'img/C7B88B.png',	choice_1: 'img/F1A78A.png',	choice_2: 'img/83764C.png'},
                    {head: 'img/C7B88B.png',	choice_1: 'img/E6A8B7.png',	choice_2: 'img/A8664B.png'},
                    {head: 'img/C7B88B.png',	choice_1: 'img/83764C.png',	choice_2: 'img/E6A8B7.png'},
                    {head: 'img/F1A78A.png',	choice_1: 'img/C7B88B.png',	choice_2: 'img/A8664B.png'},
                    {head: 'img/F1A78A.png',	choice_1: 'img/E6A8B7.png',	choice_2: 'img/A8664B.png'},
                    {head: 'img/A8664B.png',	choice_1: 'img/A06776.png',	choice_2: 'img/F1A78A.png'},
                    {head: 'img/A8664B.png',	choice_1: 'img/F1A78A.png',	choice_2: 'img/83764C.png'},
                ]

    var check = [ // colors list: R- O- Y-- G-- B- I- V--- Bl-- W- Pi- Gray--
                {head: 'img/000000.png',	choice_1: 'img/73CF10.png',	choice_2: 'img/000000.png', correct_choice: 1}, //compare black w light green
                {head: 'img/0E8A19.png',	choice_1: 'img/0E8A19.png',	choice_2: 'img/F7A75A.png', correct_choice: 0}, //compare green with muted orange
                {head: 'img/1C3D61.png',	choice_1: 'img/EA1D1D.png',	choice_2: 'img/1C3D61.png', correct_choice: 1}, // compare navy with red
                {head: 'img/2E3086.png',	choice_1: 'img/2E3086.png',	choice_2: 'img/B9B9B9.png', correct_choice: 0}, // compare lighter navy with light gray
                {head: 'img/E31B73.png',	choice_1: 'img/000000.png', choice_2: 'img/E31B73.png', correct_choice: 1}, //compare fuchsia with black
                {head: 'img/E81A4B.png',	choice_1: 'img/E81A4B.png',	choice_2: 'img/FBA714.png', correct_choice: 0}, // cocmpare red with gold
                {head: 'img/CD26C7.png',	choice_1: 'img/90689F.png',	choice_2: 'img/CD26C7.png', correct_choice: 1}, // compare violet with muted purple
                {head: 'img/A553C8.png',	choice_1: 'img/A553C8.png',	choice_2: 'img/D5B811.png', correct_choice: 0}, //compare violet2 with gold
                {head: 'img/FFFFFF.png',	choice_1: 'img/C7B88B.png',	choice_2: 'img/FFFFFF.png', correct_choice: 1}, // compare white with beige
                {head: 'img/A8664B.png',	choice_1: 'img/A8664B.png',	choice_2: 'img/B9B9B9.png', correct_choice: 0}, // compare brown with light gray
                {head: 'img/4DC7E8.png',	choice_1: 'img/E6A8B7.png',	choice_2: 'img/4DC7E8.png', correct_choice: 1} //compare light blue with muted pink
    ]
    

    //concatenate the random (25) validation trials with the chosen (32) validation trials, for a total of 57
    validation_concat = validationTrials.concat(validation);
    //console.log(validation_concat)
   // console.log(validationTrials)
    
    //console.log(validation_concat)
    
   //to shuffle the array of button choices at the beginning of the experiment   
    function shuffle(array) {
        let currentIndex = array.length,  randomIndex;
        // While there remain elements to shuffle.
        while (currentIndex != 0) {
        // Pick a remaining element.
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        // And swap it with the current element.
        [array[currentIndex], array[randomIndex]] = [
        array[randomIndex], array[currentIndex]];
        }
        return array;
    }
        
    var test_stimuli = [];
    
    // to get a random item from the array
    function getRandomItems(arr) {
        var temp_array = jsPsych.randomization.sampleWithoutReplacement(arr, 2);
          arr = arr.filter(e => e !== temp_array[0]);
          arr = arr.filter(e => e !== temp_array[1]);
        return temp_array;
    }
      
      
    /* define welcome message trial */
    var welcome = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: "Welcome to the experiment. Press any key to begin."
    };
    timeline.push(welcome);
      
      
    timeline.push({
      type: jsPsychFullscreen,
      fullscreen_mode: true
    });    
         
    /* define consent trail */
    var consent = {
        type: jsPsychImageButtonResponse,
        stimulus: "kc_lab_consent_prolific.png", // CHANGE THIS (to Mturk/Prolific or SONA depending on your sample)
        choices: ["Consent & Continue"]
    };
    timeline.push(consent);
      
    var lasttrialdata_rt = 0;

   var displayAdjust = {
        type: jsPsychSurveyHtmlForm,
        preamble:
            "<p>Before beginning the experiment, please ensure that you are using a computer to complete the experiment, NOT a phone or tablet, " +
            "and that you are in a dark room. "+
            "Next, please take a look at the set of five squares below. Some squares are the same color as the background, while others are slightly darker or lighter. THe squares that differ from the background will become visible when the screen brightness is at maximum. "+
            "Please adjust your screen brightness until you can see the squares, and report how many of the five squares differ from the background.</br>" +
            "On Mac, brightness can be adjusted by navigating to System Settings > Displays.</p>"+
            
                '<div style= "height:100px;width:100px;border:00px solid powderblue;display: inline-block; background:rgb(89,89,89)"></div>'+
                '<div style= "height:100px;width:100px;border:00px solid powderblue;display: inline-block; background:rgb(90,90,90)"></div>'+
                '<div style= "height:100px;width:100px;border:00px solid powderblue;display: inline-block; background:rgb(89,89,89)"></div>'+
                '<div style= "height:100px;width:100px;border:00px solid powderblue;display: inline-block; background:rgb(88,88,88)"></div>'+
                '<div style= "height:100px;width:100px;border:00px solid powderblue;display: inline-block; background:rgb(90,90,90)"></div>'+

            "<p>Click 'Continue' when you have adjusted your settings.</p>",
        html: '<p> There are <input name="first" type="text" /> squares.</p>'
    };
    timeline.push(displayAdjust)

          
    /* define testing instructions */
    var instructions = {
      type: jsPsychHtmlButtonResponse, // CHANGE THIS (instructions)
      stimulus: "<p>In each trial of this task, you will see three images: one target item on top, and two choices beneath the target item." +
        "</p><p>For each trial, <strong>please select the item that is most like the target item.</strong>"+
        "<p>There may be trials with no obvious answer. In those cases, use your best judgment." +
        "<p>There will be 3 rounds of this task with 264 trials per round. You will have the opportunity to take breaks between rounds. </p>"+
          "<p>Click 'Continue' to begin the test.</p>",
        choices: ["Continue"],
        post_trial_gap: 2000,
        on_finish: function(){
            shuffle(validation_concat);

        }
    };
   timeline.push(instructions);  
      
      
      var fixation = {
          type: jsPsychHtmlKeyboardResponse,
            stimulus: '+',
            choices: "NO_KEYS",
            trial_duration: 500
        };
      timeline.push(fixation);
      
      var arr_pair = [];

// define the trials!
      var trial = {
          type: jsPsychImageButtonResponse,
            stimulus: jsPsych.timelineVariable('item'),    // IF YOU CHANGED THE OBJECT NAMES IN YOUR ARRAY ABOVE, CHANGE THEM HERE TO MATCH     
            choices: function(){
                shuffle(stimuli_arr);
                arr_pair = getRandomItems(stimuli_arr);
                // the following makes sure the choices and stimulus are NOT the same!
                while(arr_pair[0] == jsPsych.timelineVariable('item') || arr_pair[1] == jsPsych.timelineVariable('item')){
                    arr_pair = getRandomItems(stimuli_arr);
                }
                return arr_pair;
            },
            button_html: '<button class="jspsych-btn-ckz"><img src= %choice%></button>',
            on_finish: function(data){
                
                shuffle(stimuli_arr); // CHANGE THIS TO MATCH THE REGULAR ARRAY YOU SPECIFIED ABOVE
                data.choices = arr_pair;
                n = 1;
                var data_last1 = jsPsych.data.get().last(n);
                lasttrialdata_rt = data_last1.select('rt').mean();
                if (lasttrialdata_rt < 900){
                      data.speedy = true;
                    } else {
                      data.speedy = false; 
                }
                data.sampleAlg = "random";
            }
      };
      
      // define the validation trials!
      var validation_trial = {
          type: jsPsychImageButtonResponse,
            stimulus: function(){
                row = validation_concat.pop(); //was just validation
                head = row.head;
                return head;},         
            choices: function(){
                arr_pair = [row.choice_1, row.choice_2];
                return arr_pair;
            },
            button_html: '<button class="jspsych-btn-ckz"><img src= %choice%></button>',
          on_finish: function(data){
           
              data.choices = arr_pair;
              n = 1;
                var data_last = jsPsych.data.get().last(n);
                lasttrialdata_rt = data_last.select('rt').mean();
                if (lasttrialdata_rt < 1000){
                      data.speedy = true;
                    } else {
                      data.speedy = false; 
                }
              data.sampleAlg = "validation"
          }
      };

      // define the attention checks!
      var check_trial = {
          type: jsPsychImageButtonResponse,
            stimulus: jsPsych.timelineVariable('head'),         
            choices: function(){
                arr_pair = [jsPsych.timelineVariable('choice_1'), jsPsych.timelineVariable('choice_2')];
                return arr_pair;
            },
            button_html: '<button class="jspsych-btn-ckz"><img src= %choice%></button>',
          on_finish: function(data){
            
              data.choices = arr_pair;
              if (data.response == jsPsych.timelineVariable('correct_choice')){
                  data.correct = true;
                } else {
                  data.correct = false; 
              }
              data.sampleAlg = "check";
          }
      };
    
        
        var if_trial_check = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: "<p><strong>Incorrect!</strong></p>That was an attention check. Please pay attention while completing this task.<p>Press 'y' to continue.</p>",
            choices:["y"]
        }

        var if_node_check = {
            timeline: [if_trial_check],
            conditional_function: function(){
                // get the data from the previous trial,
                // and check which key was pressed
                var last_trial_correct = jsPsych.data.get().last(1).values()[0].correct;
                if(last_trial_correct){
                    return false; // the parameter value has to be returned from the function
                } else {
                    return true; // the parameter value has to be returned from the function
                }
            }
        }
        
        var if_trial_speed = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: "<p><strong>You're going too fast.</strong><p>Please slow down and assess each triplet." +
                  "<p>Press 'y' to continue.</p></p>",
            choices: ["y"]
        }

        var if_node_speed = {
            timeline: [if_trial_speed],
            conditional_function: function(){
                // get the data from the previous trial,
                // and check which key was pressed
                var last_trial_speed = jsPsych.data.get().last(1).values()[0].speedy;
                if(last_trial_speed){
                    return true; // the parameter value has to be returned from the function;
                } else{
                    return false;
                }
            }
        }
    
       
    // okay so this is to get a random set of elements...  
    function getRandom(arr, n) {
        var result = new Array(n),
            len = arr.length,
            taken = new Array(len);
        if (n > len)
            throw new RangeError("getRandom: more elements taken than available");
        while (n--) {
            var x = Math.floor(Math.random() * len);
            result[n] = arr[x in taken ? taken[x] : x];
            taken[x] = --len in taken ? taken[len] : len;
        }
        return result;
    }
      

var validation_procedure = {
    timeline: [fixation, validation_trial, if_node_speed],
    timeline_variables: validation_concat, //changed from just validation
    prompt: "Select the item most similar to the item on top",
    sample :{
        type: 'without-replacement',
        size: 10 // CHANGE THIS if you want a different number of validation trials per block; originally 5
    }
};
      
var trial_procedure = {
    timeline: [fixation, trial, if_node_speed],
    timeline_variables: stimuli,
    prompt: "Select the item most similar to the item on top",
    randomize_order: true,
    sample: {
        type: 'with-replacement', //originally with replacement
        size: 236 // CHANGE THIS if you want a different number of regular trials per block; it is originally 20
    }
};
          
      
var check_procedure = {
    timeline: [fixation, check_trial, if_node_check],
    timeline_variables: check,
    prompt: "Select the item most similar to the item on top",
    sample: {
        type: 'without-replacement',//originally without 
        size: 2 // CHANGE THIS if you want a different number of check trials per block
    }
};

var quick_break = {
    type: jsPsychHtmlButtonResponse,
    stimulus: "Nice job! Feel free to take a quick break, then click 'Continue' when you are ready proceed to the next round." +
    "<p>Remember, your task is to <strong>select the item closest to the item on top.</strong>",
    choices: ["Continue"]
};
      
    
    // 786 trials total
        // 60 are validation trials; 
        // 708 are "regular" trials
        // 18 are attention checks
        // and repeat 12 times
    var procedure = {
        timeline: [trial_procedure, check_procedure, validation_procedure, check_procedure, validation_procedure, check_procedure, quick_break],
        randomize_order: true,
        repetitions:3
    };
      
      
  // run the procedure twice with a break in between
      timeline.push(procedure);
      //timeline.push(quick_break);
      //timeline.push(procedure);

  //-----------------------------------------color vision check-----------------------------------------

      // Ishihara color vision check //
  var ishihara_instructions = {
    type: jsPsychHtmlButtonResponse,
        stimulus: 
        "<p>Next, you will see an image on the screen." +
        "<br>If you see a number in the image, please type that number in the box.</p>"+
        "<p>If you do not see a number in the image, please type 'None' in the box."+
        "<br>This part of the experiment will take about 1 minute.</p>"+
        "<p>Please press the spacebar to begin.</p>",
        post_trial_gap: 500,
        choices: [32]
    };
    timeline.push(ishihara_instructions);


    //random function
    function getRandomIntInclusive(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return  Math.floor(Math.random() * (max - min + 1));
        }
    //

   //Loop to present 6 ishihara plates of a unique type
   var plateCounter = [0,0,0,0,0,0]
   var numPlates = 6; 
   for (plateNum = 0; plateNum < numPlates;){

        //Randomly select which plate for a given type
        var plate = getRandomIntInclusive(0,5);

        //always present this plate first
        if (plateNum == 0){
                plate = 0; 
                whichPlate = 0;
                answer  =  JSON.stringify({"ishihara":"12"});
        }

        //present the other 5 in a random order
        if (plate == 1 | plate == 3 | plate == 5){
                whichPlate = getRandomIntInclusive(0,1);
               if (plate == 1 & whichPlate == 0){
                    answer = JSON.stringify({"ishihara":"8"});
                }else if (plate == 1 & whichPlate == 1){
                    answer = JSON.stringify({"ishihara":"29"}); 
                }else if (plate == 3 & whichPlate == 0){
                    answer = JSON.stringify({"ishihara":"6"}); 
                }else if (plate == 3 & whichPlate == 1){
                    answer = JSON.stringify({"ishihara":"45"});
                }else if (plate == 5 & whichPlate == 0){
                    answer = JSON.stringify({"ishihara":"26"}); 
                }else if (plate == 5 & whichPlate == 1){
                    answer = JSON.stringify({"ishihara":"42"});  
                 }
            }else if (plate == 2 | plate == 4){
                whichPlate = getRandomIntInclusive(0,3);
                if (plate == 2 & whichPlate == 0){
                    answer = JSON.stringify({"ishihara":"5"}); 
                }else if (plate == 2 & whichPlate == 1){
                    answer = JSON.stringify({"ishihara":"3"}); 
                }else if (plate == 2 & whichPlate == 2){
                    answer = JSON.stringify({"ishihara":"15"});
                }else if (plate == 2 & whichPlate == 3){
                    answer = JSON.stringify({"ishihara":"74"}); 
                }else if (plate == 4 & whichPlate == 0){
                    answer = JSON.stringify({"ishihara":"5"}); 
                }else if (plate == 4 & whichPlate == 1){
                    answer = JSON.stringify({"ishihara":"7"}); 
                }else if (plate == 4 & whichPlate == 2){
                    answer = JSON.stringify({"ishihara":"16"}); 
                }else if (plate == 4 & whichPlate == 3){
                    answer = JSON.stringify({"ishihara":"73"}); 
                }
        }
        //Check to ensure this plate not previously presented
        if (plateCounter[plate] == 0) {

            //Present trial
            var ishihara_plate = {
                type: jsPsychImageTextResponseMAS,
                stimulus: "ishiharaPlateImg/IshiharaPlates-"+plate+"-"+whichPlate+".png", 
                stimulus_height: 400, 
                correctAnswer: answer,
                on_start: function(trial) {
                    correctAnswer = trial.correctAnswer}, //recorded in the "prompt" column of the output
                questions: [
                    { prompt: "Type what number you see. "+
                        "<p>If you do not see a number, type 'None'.",
                    rows: 1, 
                    columns: 1,
                    required: true,
                    name: 'ishihara'}],
                    button_label: "Next",
                    on_finish: function(data){
                            if(data.responses == correctAnswer){
                                data.correct = 1;  //correct
                            } else {
                                data.correct = 0;}} //incorrect
                    }         
            timeline.push(ishihara_plate) 
            plateCounter[plate] = 1; 
            plateNum++
        }
    }


    // Color Vision check //
    var colorvision = {
        type: jsPsychSurveyMultiSelect,
        questions: [
            {prompt: "Do you have difficulty seeing colors or noticing differences<br>between colors compared to the average person?",
            options: ["Yes", "No"],
            horizontal: false,
            required: true, 
            name: 'colorDifficulty'},

            {prompt: "Do you consider yourself to be colorblind? ",
            options: ["Yes", "No"],
            horizontal: false,
            required: true, 
            name: 'colorBlind'},

            {prompt: "What device did you use to complete this experiment?",
            options: ["Computer", "Tablet", "Phone", "Other"],
            horizontal: false,
            required: true, 
            name: 'device'}
        ],
        preamble: "",
        button_label: "Done",
        randomize_question_order: false,
        }; 
    timeline.push(colorvision); 
 
    //-----------------------------------------end ishihara-----------------------------------------
    
var demographic_instructions = {
      type: jsPsychHtmlButtonResponse,
      stimulus: "<p>Thank you.<p>For this last part of the experiment, please provide us with information about yourself.</p> ",
      choices: ["Continue"],
      post_trial_gap: 1000
    };
timeline.push(demographic_instructions);
      
      
var demographics = {
    type: jsPsychSurveyMultiSelect,
    questions: [
      {prompt: "Which categories describe you? Select all that apply to you:", 
        options: ["American Indian or Alaska Native - For example, Navajo Nation, Mayan", 
                  "Asian - For example, Chinese, Asian Indian",
                  "Black or African American - For example, Jamaican, Ethiopian",
                  "Hispanic or Latino - For example, Mexican or Mexican American, Puerto Rican, Salvadoran",
                 "Middle Eastern or North African - For example, Lebanese, Iranian, Moroccan",
                 "Native Hawaiian or Other Pacific Islander - For example, Somoan, Fijian",
                 "White - For example, German, Irish",
                 "Some other race, ethnicity, or origin",
                 "I prefer not to answer"], 
        horizontal: false,
        required: true,
        name: 'race_eth'}
    ]};
    timeline.push(demographics);  

    
    var id_age = {
      type: jsPsychSurveyText,     // CHANGE THIS (written survey questions)
      questions: [{prompt: "Please enter your age (in years):", rows: 1, columns: 6, name: "age", required: true}, 
                  {prompt: "How do you currently describe your gender identity? Please specify.", rows: 1, columns: 60, name: "gender"},
                  {prompt: "What country do you live in?", rows : 1, columns: 40, name: "country"},
                  {prompt: "What is your primary language?", rows : 1, columns: 40, name: "main_lang", required: true},
                  {prompt: "Which other language(s) can you speak, if any?", rows : 1, columns: 40, name: "all_lang", required: true}
                 ]
    };
    timeline.push(id_age);

    var monitor_settings = {
      type: jsPsychSurveyText,     // CHANGE THIS (written survey questions)
      questions: [{prompt: "Please enter the make and model of your computer:", rows: 1, columns: 6, name: "age", required: true}, 
                  {prompt: "If you have an external monitor that is different from the make/model of your computer, please enter the monitor model here. Otherwise, enter N/A.", rows: 1, columns: 60, name: "gender"},
                  {prompt: "Please enter the color profile of your computer. On Mac, this can be found under Settings > Displays.", rows : 1, columns: 40, name: "country"}
                 ]
    };
    timeline.push(monitor_settings);
      
      
      
   var goodbye = {
      type: jsPsychHtmlButtonResponse,
      stimulus: function(){
        // the secret code changes for different experiments on Prolific
        output = "Great job! You have finished the experiment. <br> <strong> Here is your secret code: C18AM5PA </strong><br> Goodbye!<br><br>";
      return output;
      },
      choices: ["<a href='https://app.prolific.com/submissions/complete?cc=C18AM5PA'>Complete Experiment</a>"]    
   };
    
    timeline.push(save_data);
    timeline.push(goodbye);

      
//     // this is to save to normal server
//    function saveData(name, data){
//      var xhr = new XMLHttpRequest();
//      xhr.open('POST', 'data_write.php'); // 'write_data.php' is the path to the php file described above.
//      xhr.setRequestHeader('Content-Type', 'application/json');
//      xhr.send(JSON.stringify({filename: name, filedata: data}));
//    }
    

      
    jsPsych.run(timeline);


  </script>
  </html>

<!--

-->
